<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Life Path: Rise to Power — Deployments & Medals</title>
<style>
  :root{
    --bg:#061223; --panel:#0f1724; --accent:#7dd3fc; --muted:#9ca3af; --good:#34d399; --bad:#fb7185; --gold:#f59e0b;
  }
  html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg),#02141b);font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;color:#e6eef8}
  .app{max-width:1200px;margin:18px auto;padding:18px}
  header{display:flex;gap:12px;align-items:center;margin-bottom:12px}
  h1{margin:0;font-size:20px;color:var(--accent)}
  .row{display:flex;gap:12px}
  .panel{background:linear-gradient(180deg,var(--panel),rgba(255,255,255,0.02));padding:12px;border-radius:10px;box-shadow:0 8px 30px rgba(2,6,23,0.6);flex:1;min-width:0}
  .sidebar{width:340px;flex:0 0 340px}
  .stat{display:flex;justify-content:space-between;align-items:center;margin:6px 0}
  .stat .bar{height:10px;background:#072033;border-radius:8px;overflow:hidden;margin-left:10px;flex:1}
  .stat .bar > i{display:block;height:100%}
  .controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
  button{background:linear-gradient(180deg,#0e76a8,#0b4f73);border:0;color:white;padding:8px 10px;border-radius:8px;cursor:pointer}
  button.alt{background:linear-gradient(180deg,#2b6cb0,#1e3a8a)}
  button.danger{background:linear-gradient(180deg,#ef4444,#b91c1c)}
  select,input{padding:6px;border-radius:6px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:inherit}
  .log{height:180px;overflow:auto;background:rgba(255,255,255,0.02);padding:8px;border-radius:8px;font-size:13px}
  .big{font-size:14px}
  .center{display:flex;align-items:center;justify-content:center}
  .title{font-weight:700;color:var(--accent)}
  .section{margin-bottom:12px}
  .role-pill{display:inline-block;padding:6px 8px;border-radius:999px;background:rgba(255,255,255,0.03);margin:4px 4px 4px 0}
  .muted{color:var(--muted)}
  .large-btn{padding:10px 14px;font-weight:700}
  .notice{background:linear-gradient(90deg,#072033,#02121a);padding:10px;border-radius:8px;margin-bottom:8px}
  .grid{display:grid;grid-template-columns:1fr 1fr;gap:8px}
  .medal {display:flex;align-items:center;gap:8px;padding:8px;border-radius:8px;background:rgba(255,255,255,0.02);margin:6px 0}
  .medal .icon{width:44px;height:44px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:700}
  .medal.gold .icon{background:linear-gradient(90deg,#fbbf24,#f59e0b);color:#042018}
  .medal.silver .icon{background:linear-gradient(90deg,#cbd5e1,#94a3b8);color:#042018}
  .medal.bronze .icon{background:linear-gradient(90deg,#f6ad55,#c2410c);color:#042018}
  @media(max-width:1000px){.row{flex-direction:column}.sidebar{width:100%;flex:1}}
</style>
</head>
<body>
<div class="app">
  <header>
    <h1>Life Path: Rise to Power — Deployments & Medals</h1>
    <div class="muted">Complex single-file life sim — now with deployments, medals & achievements</div>
  </header>

  <div class="row">
    <div class="panel sidebar">
      <div class="section">
        <div class="title">Create / Load Character</div>
        <div style="margin-top:8px">
          <input id="nameInput" placeholder="Your name (ex: Alex Carter)" />
          <select id="regionSelect">
            <option value="us">United States (President)</option>
            <option value="uk">United Kingdom (Prime Minister)</option>
            <option value="ca">Canada (Prime Minister)</option>
            <option value="de">Germany (Chancellor)</option>
            <option value="au">Australia (Prime Minister)</option>
          </select>
        </div>
        <div class="controls" style="margin-top:8px">
          <button id="newBtn" class="large-btn">New Life</button>
          <button id="loadBtn" class="alt">Load</button>
          <button id="resetBtn" class="danger">Reset</button>
        </div>
      </div>

      <div class="section">
        <div class="title">Stats</div>
        <div id="ageLine" class="muted">Age: —</div>
        <div class="stat"><div>Charisma</div><div style="display:flex;align-items:center"><div id="statChar" style="width:60px;text-align:right">—</div><div class="bar" style="width:100px"><i id="charBar" style="width:0%;background:linear-gradient(90deg,#60a5fa,#38bdf8)"></i></div></div></div>
        <div class="stat"><div>Intelligence</div><div style="display:flex;align-items:center"><div id="statInt" style="width:60px;text-align:right">—</div><div class="bar" style="width:100px"><i id="intBar" style="width:0%;background:linear-gradient(90deg,#c084fc,#7c3aed)"></i></div></div></div>
        <div class="stat"><div>Fitness</div><div style="display:flex;align-items:center"><div id="statFit" style="width:60px;text-align:right">—</div><div class="bar" style="width:100px"><i id="fitBar" style="width:0%;background:linear-gradient(90deg,#34d399,#10b981)"></i></div></div></div>
        <div class="stat"><div>Leadership</div><div style="display:flex;align-items:center"><div id="statLead" style="width:60px;text-align:right">—</div><div class="bar" style="width:100px"><i id="leadBar" style="width:0%;background:linear-gradient(90deg,#f59e0b,#f97316)"></i></div></div></div>
        <div class="stat"><div>Reputation</div><div style="display:flex;align-items:center"><div id="statRep" style="width:60px;text-align:right">—</div><div class="bar" style="width:100px"><i id="repBar" style="width:0%;background:linear-gradient(90deg,#60a5fa,#34d399)"></i></div></div></div>
        <div style="margin-top:8px" class="muted">XP: <span id="xp">—</span></div>
      </div>

      <div class="section">
        <div class="title">Quick Actions</div>
        <div class="controls">
          <button id="passYearBtn">Pass 1 Year</button>
          <button id="pass5Btn" class="alt">Pass 5 Years</button>
          <button id="autoPlayBtn" class="alt">Auto Play 10 years</button>
        </div>
        <div style="margin-top:8px" class="muted">Choices affect outcomes. Military service yields deployments, medals, and leadership growth.</div>
      </div>

      <div class="section">
        <div class="title">Save / Export</div>
        <div style="margin-top:8px" class="controls">
          <button id="saveBtn">Save</button>
          <button id="exportBtn" class="alt">Export JSON</button>
        </div>
        <textarea id="exportArea" style="width:100%;height:70px;margin-top:8px;background:#02111a;border-radius:6px;color:#cfeffd;padding:8px"></textarea>
      </div>

      <div class="section">
        <div class="title">Medals & Achievements</div>
        <div id="medalsList" class="muted">No medals yet</div>
      </div>
    </div>

    <div class="panel" style="flex:1;min-width:0">
      <div class="section">
        <div class="title">Game Log</div>
        <div id="log" class="log"></div>
      </div>

      <div class="section">
        <div class="title">Decisions & Actions</div>
        <div id="decisionBlock" class="muted">Start a new life to see available actions.</div>
      </div>

      <div class="section">
        <div class="title">Deployments</div>
        <div id="deployBlock" class="muted">No deployments yet</div>
      </div>

      <div class="section">
        <div class="title">Progress & Roles</div>
        <div id="rolesBlock" class="muted">—</div>
      </div>

      <div class="section">
        <div class="title">Detailed Stats & History</div>
        <div class="grid">
          <div>
            <div class="muted" id="historyBlock">—</div>
          </div>
          <div>
            <div class="muted" id="achieveBlock">—</div>
          </div>
        </div>
      </div>

      <footer style="margin-top:12px" class="muted">Tip: volunteer for deployments strategically — they can accelerate promotions and earn medals, but increase risk.</footer>
    </div>
  </div>
</div>

<script>
/*
  Extended Life Path — deployments & medals
  Single-file game ready for GitHub Pages
  Author: ChatGPT (assistant)
*/

// Utilities
function rand(min,max){return Math.floor(Math.random()*(max-min+1))+min}
function clamp(v,a=0,b=100){return Math.max(a,Math.min(b,v))}
function nowStr(){return new Date().toLocaleString()}
function log(msg){let el=document.getElementById('log'); el.innerHTML = `<div>${new Date().toLocaleDateString()} — ${msg}</div>` + el.innerHTML;}

// Region & game data
const REGIONS = {
  us: {name:'United States',topTitle:'President',midTitle:'Senator/Representative',local:'Mayor',partySystem:true,termYears:4},
  uk: {name:'United Kingdom',topTitle:'Prime Minister',midTitle:'MP',local:'Mayor/Local Councillor',partySystem:true,termYears:5},
  ca: {name:'Canada',topTitle:'Prime Minister',midTitle:'MP',local:'Mayor',partySystem:true,termYears:4},
  de: {name:'Germany',topTitle:'Chancellor',midTitle:'Bundestag Member',local:'Mayor',partySystem:true,termYears:4},
  au: {name:'Australia',topTitle:'Prime Minister',midTitle:'MP',local:'Mayor',partySystem:true,termYears:3}
};

const UNIT_TRYOUTS = {
  'Navy SEALs': {req:{fitness:70,lead:50},time:2,successBase:30,bonusStat:'fitness'},
  'Green Berets': {req:{fitness:65,lead:60,int:50},time:2,successBase:25,bonusStat:'leadership'},
  'Para-Commandos': {req:{fitness:60,lead:45},time:1,successBase:35,bonusStat:'fitness'},
  'Airborne Rangers': {req:{fitness:60,lead:50},time:1,successBase:33,bonusStat:'fitness'}
};

const MILITARY_RANKS = ['Private','Corporal','Sergeant','Lieutenant','Captain','Major','Lieutenant Colonel','Colonel','Brigadier','Major General','Lieutenant General','General'];

// Deployment types
const DEPLOYMENT_TYPES = {
  combat: {label:'Combat Operation',baseReputation:8,baseXP:60,baseRisk:18,medalChances:{valor:0.15,lead:0.08,campaign:0.5}},
  peacekeeping: {label:'Peacekeeping',baseReputation:6,baseXP:40,baseRisk:8,medalChances:{valor:0.05,lead:0.1,campaign:0.55}},
  humanitarian: {label:'Humanitarian',baseReputation:10,baseXP:35,baseRisk:4,medalChances:{valor:0.02,lead:0.12,campaign:0.6}}
};

// Civilian jobs
const CIVILIAN_JOBS = [
  {id:'student', title:'Student (University)',time:3,effect:s=>{ s.intelligence += rand(6,12); s.xp += 30; }},
  {id:'tech', title:'Junior Developer',time:2,effect:s=>{ s.intelligence += rand(2,6); s.charisma += rand(1,4); s.xp += 20; }},
  {id:'journalist', title:'Journalist',time:2,effect:s=>{ s.charisma += rand(3,7); s.reputation += rand(2,6); s.xp += 18; }},
  {id:'business', title:'Business Startup',time:3,effect:s=>{ s.leadership += rand(3,9); s.reputation += rand(1,6); s.xp += 24; }},
  {id:'law', title:'Law Student',time:3,effect:s=>{ s.intelligence += rand(4,10); s.charisma += rand(0,4); s.xp += 28; }}
];

// Medals/achievements catalog
const MEDAL_CATALOG = {
  'Campaign Medal': {tier:'bronze',desc:'Served on a deployment or campaign.'},
  'Valour Star': {tier:'gold',desc:'Awarded for conspicuous bravery during combat operations.'},
  'Leadership Cross': {tier:'gold',desc:'Exceptional leadership on deployment or as commander.'},
  'Humanitarian Ribbon': {tier:'silver',desc:'Outstanding humanitarian service.'},
  'Long Service Medal': {tier:'silver',desc:'Years of honorable military service.'},
  'Unit Badge': {tier:'bronze',desc:'Complete selection and serve in an elite unit.'},
  'Founders Medal': {tier:'gold',desc:'Founded a successful company or organization.'},
  'Election Victory': {tier:'gold',desc:'Won a major election.'},
  'Legislative Achiever': {tier:'silver',desc:'Passed significant legislation while in office.'},
  'Civil Service Star': {tier:'bronze',desc:'Long service in civil/administrative positions.'}
};

// Save key
const SAVE_KEY = 'life_path_deploy_v2';

// State
let state = null;

// Helpers for medals & achievements
function awardMedal(key, reason){
  if(!state) return;
  if(!MEDAL_CATALOG[key]) return;
  if(!state.medals) state.medals = [];
  if(state.medals.includes(key)) return; // unique for now
  state.medals.push(key);
  state.achievements.push(`${key} — ${reason}`);
  log(`Medal awarded: ${key} (${reason})`);
  pushHistory(`Medal: ${key} — ${reason}`);
  save();
}

function awardAchievement(text){
  if(!state) return;
  state.achievements.push(text);
  log(`Achievement: ${text}`);
  pushHistory(`Achievement: ${text}`);
  save();
}

// --- Core functions
function newLife(name, regionKey){
  const region = REGIONS[regionKey] || REGIONS.us;
  state = {
    name: name || 'Player',
    region: regionKey,
    regionName: region.name,
    age: 18,
    stats: {
      charisma: rand(30,60),
      intelligence: rand(30,70),
      fitness: rand(30,65),
      leadership: rand(25,60),
      reputation: rand(10,30)
    },
    xp: 0,
    career: {type:'none', title:'None', yearsInRole:0,history:[]},
    military: {enlisted:false, branch:null, rankIndex:-1,years:0,units:[],deployments:[]},
    politics:{inOffice:false, offices:[],party:null},
    medals:[],
    achievements:[],
    history:[],
    auto:false
  };
  log(`${state.name} begins life in ${region.name} at age ${state.age}.`);
  pushHistory(`Start life. ${statString()}`);
  save();
  renderAll();
}

function statString(){
  const s=state.stats;
  return `CHA ${s.charisma}, INT ${s.intelligence}, FIT ${s.fitness}, LEAD ${s.leadership}, REP ${s.reputation}`;
}

function save(){ try{ localStorage.setItem(SAVE_KEY, JSON.stringify(state)); log('Saved.'); }catch(e){console.error(e); log('Save failed.');} }
function load(){ const raw = localStorage.getItem(SAVE_KEY); if(!raw) return false; try{ state = JSON.parse(raw); log(`Loaded ${state.name}'s life.`); renderAll(); return true; } catch(e){ console.error(e); return false; } }
function resetGame(){ if(confirm('Reset saved life?')){ localStorage.removeItem(SAVE_KEY); state=null; document.getElementById('log').innerHTML=''; renderAll(); } }

function pushHistory(text){ if(!state) return; state.history.unshift(`${new Date().toLocaleDateString()}: ${text}`); if(state.history.length>300) state.history.pop(); }

// Time passing & year ticks
function passYears(n){
  if(!state) return;
  for(let i=0;i<n;i++){
    state.age++;
    state.history.push(`${state.age}: Year passed.`);
    // baseline stat drift
    if(state.age < 40){
      state.stats.intelligence = clamp(state.stats.intelligence + rand(0,2));
      state.stats.charisma = clamp(state.stats.charisma + rand(0,2));
      state.stats.fitness = clamp(state.stats.fitness - rand(0,1));
    } else {
      state.stats.fitness = clamp(state.stats.fitness - rand(0,2));
      state.stats.intelligence = clamp(state.stats.intelligence - rand(0,1));
    }

    // career progress
    if(state.career && state.career.type !== 'none'){
      state.career.yearsInRole++;
      if(state.career.yearsInRole >= state.career.timeToComplete){
        if(typeof state.career.effect === 'function'){ state.career.effect(state.stats); }
        state.xp += state.career.xpGain || 10;
        state.career.history.push(`${state.age}: Completed ${state.career.title}`);
        awardAchievement(`Completed ${state.career.title} at ${state.age}`);
        state.career = {type:'none', title:'None', yearsInRole:0, history: state.career.history || []};
      }
    }

    // military yearly effects
    if(state.military.enlisted){
      state.military.years++;
      // promotion chance influenced by leadership & xp
      if(rand(1,100) < 25){
        const chanceModifier = Math.floor((state.stats.leadership - 40)/5) + Math.floor(state.xp/50);
        if(rand(1,100) < 30 + chanceModifier){
          promoteMilitary();
        }
      }
      // small growth
      state.stats.leadership = clamp(state.stats.leadership + rand(0,2));
      state.stats.reputation = clamp(state.stats.reputation + rand(0,2));
      // long service medal
      if(state.military.years >= 10 && !state.medals.includes('Long Service Medal')){
        awardMedal('Long Service Medal','10+ years of military service');
      }
    }

    // small reputation fluctuations
    state.stats.reputation = clamp(state.stats.reputation + rand(-1,1));
  }

  log(`${state.name} aged ${n} year(s) — now ${state.age}.`);
  pushHistory(`Aged ${n} years.`);
  save(); renderAll();
}

// Career start
function startCareer(jobId){
  const job = CIVILIAN_JOBS.find(j=>j.id===jobId);
  if(!job){ alert('Job not found.'); return; }
  state.career = {type:'civilian', id:job.id, title:job.title, yearsInRole:0, timeToComplete: job.time, effect:job.effect, xpGain:20, history: state.career.history || []};
  log(`${state.name} started: ${job.title} (takes ${job.time} years).`);
  pushHistory(`Started ${job.title}.`);
  save(); renderAll();
}

// Enlist
function enlist(branch){
  if(state.military.enlisted){ alert('Already enlisted.'); return; }
  state.military.enlisted = true;
  state.military.branch = branch || 'Army';
  state.military.rankIndex = 0;
  state.military.years = 0;
  log(`${state.name} enlisted in the ${state.military.branch}.`);
  pushHistory(`Enlisted in ${state.military.branch}.`);
  state.stats.fitness = clamp(state.stats.fitness + rand(5,12));
  state.stats.leadership = clamp(state.stats.leadership + rand(2,6));
  save(); renderAll();
}

// Promotion
function promoteMilitary(){
  if(!state.military.enlisted) return;
  if(state.military.rankIndex < MILITARY_RANKS.length - 1){
    state.military.rankIndex++;
    const rank = MILITARY_RANKS[state.military.rankIndex];
    log(`${state.name} promoted to ${rank}.`);
    pushHistory(`Promoted to ${rank} at age ${state.age}`);
    state.stats.leadership = clamp(state.stats.leadership + rand(1,4));
    state.stats.reputation = clamp(state.stats.reputation + rand(1,3));
    awardAchievement(`Promoted to ${rank}`);
    save(); renderAll();
  }
}

// Tryouts
function tryoutUnit(unitName){
  const u = UNIT_TRYOUTS[unitName];
  if(!u){ alert('Unit not found.'); return; }
  if(!state.military.enlisted){ alert('You must be enlisted to try out.'); return; }
  passYears(u.time);
  const s = state.stats;
  let score = u.successBase;
  if(u.req.fitness) score += Math.floor((s.fitness - u.req.fitness) / 2);
  if(u.req.lead) score += Math.floor((s.leadership - u.req.lead) / 2);
  if(u.req.int) score += Math.floor((s.intelligence - u.req.int) / 2);
  score += Math.floor(state.xp/50);
  const roll = rand(1,100);
  const success = roll <= clamp(score, 5, 95);
  if(success){
    state.military.units.push(unitName);
    state.stats.reputation = clamp(state.stats.reputation + rand(3,8));
    state.stats.leadership = clamp(state.stats.leadership + rand(2,6));
    awardMedal('Unit Badge',`Joined elite unit: ${unitName}`);
    log(`${state.name} succeeded tryout for ${unitName} (roll ${roll} <= ${score}).`);
    pushHistory(`Joined ${unitName} at age ${state.age}`);
  } else {
    state.stats.fitness = clamp(state.stats.fitness - rand(1,4));
    log(`${state.name} failed tryout for ${unitName} (roll ${roll} > ${score}).`);
    pushHistory(`Failed tryout: ${unitName}`);
  }
  save(); renderAll();
}

// Deployments
function startDeployment(typeKey, durationYears, engagementStyle, volunteer){
  // typeKey: combat / peacekeeping / humanitarian
  if(!state.military.enlisted){ alert('You must be enlisted to deploy.'); return; }
  const t = DEPLOYMENT_TYPES[typeKey];
  if(!t){ alert('Invalid deployment type.'); return; }
  // must not overlap active deployment (we keep them simple: can do multiple but effects additive)
  const deploy = {
    id: 'dep_' + Date.now(),
    type: typeKey,
    label: t.label,
    duration: durationYears,
    engagementStyle: engagementStyle || 'Balanced', // Aggressive / Balanced / Restraint
    volunteer: !!volunteer,
    startAge: state.age,
    outcomes: null
  };
  // consume the years immediately by passing time
  passYears(durationYears);
  // compute outcome
  const baseRisk = t.baseRisk;
  // engagement style modifies risk & reputation
  let riskMod = 0, repMod = 0, xpMod = 0;
  if(engagementStyle === 'Aggressive'){ riskMod += 8; repMod += -2; xpMod += 10; }
  if(engagementStyle === 'Balanced'){ riskMod += 0; repMod += 0; xpMod += 5; }
  if(engagementStyle === 'Restraint'){ riskMod -= 6; repMod += 6; xpMod += 2; }

  // veteran experience reduces risk
  const veteranBonus = Math.floor(state.military.years / 2);
  const finalRisk = clamp(baseRisk + riskMod - veteranBonus, 1, 95);

  // compute casualties/injuries probability
  const injuryRoll = rand(1,100);
  let injured = false;
  if(injuryRoll <= finalRisk){
    injured = true;
    const fitnessLoss = rand(3,10);
    state.stats.fitness = clamp(state.stats.fitness - fitnessLoss);
    pushHistory(`Injured on deployment (fitness -${fitnessLoss}).`);
  }

  // compute medal awards
  const medalsAwarded = [];
  // campaign medal almost always
  if(rand(1,100) <= 95){ medalsAwarded.push('Campaign Medal'); awardMedal('Campaign Medal',`Served ${deploy.label} (${durationYears}y)`); }
  // valor chance if combat and aggressive & high fitness/charisma
  if(typeKey === 'combat'){
    let valorChance = Math.floor((state.stats.fitness - 50)/2) + (engagementStyle === 'Aggressive' ? 15 : 5) + Math.floor(state.xp/100);
    if(rand(1,100) <= clamp(valorChance, 5, 90)){ medalsAwarded.push('Valour Star'); awardMedal('Valour Star','Bravery under fire'); }
  }
  // leadership cross chance
  const leadChance = Math.floor((state.stats.leadership - 45)/2) + Math.floor(state.military.years/2);
  if(rand(1,100) <= clamp(leadChance, 5, 85)){ medalsAwarded.push('Leadership Cross'); awardMedal('Leadership Cross','Exceptional command/leadership on deployment'); }
  // humanitarian ribbon for humanitarian or restraint choices
  if(typeKey === 'humanitarian' || engagementStyle === 'Restraint'){
    if(rand(1,100) <= 60){ medalsAwarded.push('Humanitarian Ribbon'); awardMedal('Humanitarian Ribbon','Outstanding humanitarian action'); }
  }

  // adjust reputation & xp
  state.stats.reputation = clamp(state.stats.reputation + t.baseReputation + repMod + (medalsAwarded.length * 2));
  state.xp += t.baseXP + xpMod + (medalsAwarded.length * 15);

  // compile outcome
  deploy.outcomes = {
    injured: injured,
    medals: medalsAwarded,
    reputationGain: t.baseReputation + repMod,
    xpGain: t.baseXP + xpMod
  };

  state.military.deployments.push(deploy);
  // award medals recorded to achievements already via awardMedal
  log(`${state.name} completed deployment: ${deploy.label} (${durationYears}y) — Engagement: ${engagementStyle}. Injured: ${injured ? 'Yes' : 'No'}. Medals: ${medalsAwarded.join(', ') || 'None'}.`);
  pushHistory(`Deployment: ${deploy.label} (${durationYears}y).`);
  save(); renderAll();
}

// Politics
function enterPolitics(startingRunType){
  if(!state) return;
  if(state.politics.inOffice){ alert('Already in office.'); return; }
  const role = startingRunType || 'Local Council';
  if(state.age < 21 && role !== 'Local Council'){ alert('Not old enough for national office.'); return; }
  const runYears = 1;
  passYears(runYears);
  const baseChance = 30 + Math.floor((state.stats.charisma - 40)/2) + Math.floor((state.stats.reputation - 30)/2);
  const roll = rand(1,100);
  const finalChance = clamp(baseChance + Math.floor(state.xp/50), 5, 95);
  if(roll <= finalChance){
    state.politics.inOffice = true;
    const officeTitle = choosePoliticalOffice(role);
    state.politics.offices.push({title:officeTitle,startAge:state.age,years:0});
    state.stats.reputation = clamp(state.stats.reputation + rand(5,10));
    awardMedal('Election Victory',`Elected ${officeTitle}`);
    log(`${state.name} WON election for ${officeTitle} (roll ${roll} <= ${finalChance}).`);
    pushHistory(`Elected ${officeTitle} at age ${state.age}`);
    save(); renderAll();
  } else {
    log(`${state.name} lost the election for ${role} (roll ${roll} > ${finalChance}).`);
    pushHistory(`Lost election: ${role}.`);
    save(); renderAll();
  }
}

function choosePoliticalOffice(role){
  const r = REGIONS[state.region];
  if(role === 'Local Council') return r.local;
  if(role === 'Parliament Entry') return r.midTitle;
  return `${r.local} Representative`;
}

function advancePoliticsYears(n){
  if(!state.politics.inOffice) return;
  state.politics.offices[state.politics.offices.length-1].years += n;
  const cur = state.politics.offices[state.politics.offices.length-1];
  state.stats.reputation = clamp(state.stats.reputation + Math.floor(n * rand(1,3)));
  state.xp += n * 8;
  // chance to produce legislation
  for(let i=0;i<n;i++){
    if(rand(1,100) < 25 + Math.floor(state.stats.intelligence/4)){
      awardMedal('Legislative Achiever','Passed important legislation');
      awardAchievement(`Passed law while ${cur.title}`);
    }
  }
  save(); renderAll();
}

function runForTopOffice(){
  if(!state) return;
  const r = REGIONS[state.region];
  if(state.age < 30 && !confirm('You are young for top office. Continue?')) return;
  const base = 15 + Math.floor((state.stats.charisma - 50)/2) + Math.floor((state.stats.reputation - 40)/2) + Math.floor(state.xp/100);
  const milBonus = state.military.enlisted ? Math.min(15, Math.floor(state.military.years/2)) : 0;
  const officeYears = state.politics.offices.reduce((a,b)=>a+b.years,0);
  const experienceBonus = Math.floor(Math.min(20, officeYears/2));
  const finalChance = clamp(base + milBonus + experienceBonus, 5, 95);
  passYears(3);
  const roll = rand(1,100);
  if(roll <= finalChance){
    state.achievements.push(`Elected ${r.topTitle}`);
    state.politics.inOffice = true;
    state.politics.offices.push({title:r.topTitle,startAge:state.age,years:0});
    state.stats.reputation = clamp(state.stats.reputation + rand(8,18));
    awardMedal('Election Victory',`Became ${r.topTitle}`);
    log(`${state.name} BECAME ${r.topTitle} of ${r.name} (roll ${roll} <= ${finalChance}).`);
    pushHistory(`Became ${r.topTitle} at age ${state.age}`);
    state.xp += 250;
    save(); renderAll();
  } else {
    log(`${state.name} lost the race for ${r.topTitle} (roll ${roll} > ${finalChance}).`);
    pushHistory(`Lost top office race.`);
    state.stats.reputation = clamp(state.stats.reputation - rand(3,8));
    save(); renderAll();
  }
}

// Non-military achievements: Found a company, pass laws, civil positions
function foundCompany(){
  if(!state) return;
  passYears(2);
  const successChance = 30 + Math.floor((state.stats.intelligence - 45)/2) + Math.floor(state.stats.leadership / 4);
  const roll = rand(1,100);
  if(roll <= clamp(successChance, 5, 95)){
    awardMedal('Founders Medal','Founded a successful organization');
    awardAchievement('Founded a company (successful)');
    state.stats.reputation = clamp(state.stats.reputation + rand(6,12));
    state.xp += 80;
    log(`${state.name} founded a successful company!`);
    pushHistory('Founded company (success).');
  } else {
    awardAchievement('Attempted to found a company (failed)');
    state.stats.reputation = clamp(state.stats.reputation - rand(1,4));
    log(`${state.name} attempted to found a company but it failed.`);
    pushHistory('Founded company (failed).');
  }
  save(); renderAll();
}

// Retire
function retire(){
  if(!state) return;
  if(!confirm('Retire? This will end active careers and offices.')) return;
  if(state.career) state.career = {type:'none',title:'Retired',yearsInRole:0,history:state.career.history||[]};
  state.military.enlisted = false;
  state.politics.inOffice = false;
  awardAchievement(`Retired at ${state.age}`);
  log(`${state.name} retired at age ${state.age}.`);
  pushHistory('Retired.');
  save(); renderAll();
}

// Export
function exportJSON(){ if(!state) return; document.getElementById('exportArea').value = JSON.stringify(state, null, 2); }

// AI autoplay (simple)
function autoPlay(years){
  if(!state) return;
  for(let i=0;i<years;i++){
    if(!state.military.enlisted && state.stats.fitness>55 && rand(1,100)<=20){ enlist('Army'); }
    if(!state.politics.inOffice && state.stats.charisma>60 && state.stats.reputation>35 && rand(1,100)<=12){ enterPolitics('Parliament Entry'); }
    if(state.military.enlisted && state.military.units.length<1 && state.stats.fitness>65 && rand(1,100)<=18){
      const unit = Object.keys(UNIT_TRYOUTS)[rand(0,Object.keys(UNIT_TRYOUTS).length-1)];
      tryoutUnit(unit);
    }
    // volunteer for a deployment occasionally if enlisted
    if(state.military.enlisted && rand(1,100) < 18){
      const types = Object.keys(DEPLOYMENT_TYPES);
      const t = types[rand(0,types.length-1)];
      const dur = rand(1,3);
      const style = ['Aggressive','Balanced','Restraint'][rand(0,2)];
      startDeployment(t,dur,style,true);
    }
    passYears(1);
    if(state.politics.offices.some(o => o.title === REGIONS[state.region].topTitle)) break;
  }
}

// UI Rendering
function renderAll(){
  const elAge = document.getElementById('ageLine');
  const s = state ? state.stats : null;
  elAge.textContent = state ? `Age: ${state.age} — Region: ${state.regionName}` : 'Age: —';
  document.getElementById('statChar').textContent = s ? s.charisma : '—';
  document.getElementById('statInt').textContent = s ? s.intelligence : '—';
  document.getElementById('statFit').textContent = s ? s.fitness : '—';
  document.getElementById('statLead').textContent = s ? s.leadership : '—';
  document.getElementById('statRep').textContent = s ? s.reputation : '—';
  document.getElementById('xp').textContent = state ? state.xp : '—';
  if(s){
    document.getElementById('charBar').style.width = `${s.charisma}%`;
    document.getElementById('intBar').style.width = `${s.intelligence}%`;
    document.getElementById('fitBar').style.width = `${s.fitness}%`;
    document.getElementById('leadBar').style.width = `${s.leadership}%`;
    document.getElementById('repBar').style.width = `${s.reputation}%`;
  } else {
    ['charBar','intBar','fitBar','leadBar','repBar'].forEach(id=>document.getElementById(id).style.width='0%');
  }

  // decisions
  const decBlock = document.getElementById('decisionBlock');
  if(!state){ decBlock.innerHTML = 'Create a new life to get started.'; } else {
    let html = `<div class="notice"><strong>Available actions (age ${state.age})</strong></div><div style="display:flex;gap:8px;flex-wrap:wrap">`;

    // civilian
    if(!state.career || state.career.type === 'none'){
      html += `<div><div class="muted">Civilian career:</div>`;
      CIVILIAN_JOBS.forEach(j=>{
        html += `<div class="role-pill">${j.title} <button onclick="startCareer('${j.id}')" class="alt">Start</button></div>`;
      });
      html += `<div style="margin-top:6px"><button onclick="foundCompany()" class="alt">Found Company</button></div>`;
      html += `</div>`;
    } else {
      html += `<div class="muted">Active: ${state.career.title} (${state.career.yearsInRole}/${state.career.timeToComplete})</div>`;
    }

    // military
    if(!state.military.enlisted){
      html += `<div style="margin-top:8px"><strong>Military</strong><div class="muted">Enlist:</div>
        <button onclick="enlist('Army')">Army</button>
        <button onclick="enlist('Navy')" class="alt">Navy</button>
        <button onclick="enlist('Air Force')" class="alt">Air Force</button>
        <button onclick="enlist('Marines')" class="alt">Marines</button>
      </div>`;
    } else {
      html += `<div style="margin-top:8px"><strong>Military</strong><div class="muted">Branch: ${state.military.branch} — Rank: ${MILITARY_RANKS[state.military.rankIndex] || '—'}</div>`;
      html += `<div class="muted">Tryouts:</div>`;
      Object.keys(UNIT_TRYOUTS).forEach(u=>{
        html += `<div class="role-pill">${u} <button onclick="tryoutUnit('${u}')">Tryout</button></div>`;
      });
      html += `<div style="margin-top:6px" class="muted">Deploy:</div>
        <button onclick="showDeployModal('combat')">Combat</button>
        <button onclick="showDeployModal('peacekeeping')" class="alt">Peacekeeping</button>
        <button onclick="showDeployModal('humanitarian')" class="alt">Humanitarian</button>
      </div>`;
    }

    // politics
    if(!state.politics.inOffice){
      html += `<div style="margin-top:8px"><strong>Politics</strong><div class="muted">Run for office:</div>
        <button onclick="enterPolitics('Local Council')">Run for Local (${REGIONS[state.region].local})</button>
        <button onclick="enterPolitics('Parliament Entry')">Run for ${REGIONS[state.region].midTitle}</button>
        <button onclick="runForTopOffice()" class="alt">Run for ${REGIONS[state.region].topTitle}</button>
      </div>`;
    } else {
      const cur = state.politics.offices[state.politics.offices.length-1];
      html += `<div style="margin-top:8px"><strong>In Office</strong><div class="muted">${cur.title} — ${cur.years} years (since ${cur.startAge})</div>
        <button onclick="advancePoliticsYears(1)">Serve 1 year</button>
        <button onclick="advancePoliticsYears(5)" class="alt">Serve 5 years</button>
        <button onclick="runForTopOffice()" class="alt">Try for top office</button>
      </div>`;
    }

    html += `<div style="margin-top:8px"><strong>Other</strong>
      <button onclick="retire()" class="danger">Retire</button>
    </div>`;

    html += `</div>`;
    decBlock.innerHTML = html;
  }

  // deployments
  const depBlock = document.getElementById('deployBlock');
  if(!state){ depBlock.innerHTML = '—'; } else {
    if(!state.military.deployments || state.military.deployments.length === 0){
      depBlock.innerHTML = '<div class="muted">No deployments yet.</div>';
    } else {
      let html = '';
      state.military.deployments.slice().reverse().forEach(d=>{
        html += `<div style="margin-bottom:8px;padding:8px;border-radius:8px;background:rgba(255,255,255,0.02)"><strong>${d.label}</strong> — ${d.duration}y — Eng: ${d.engagementStyle} — StartAge: ${d.startAge}<div>Injured: ${d.outcomes.injured ? '<span style="color:#fb7185">Yes</span>' : '<span style="color:#34d399">No</span>'} — Medals: ${(d.outcomes.medals.length ? d.outcomes.medals.join(', ') : 'None')}</div></div>`;
      });
      depBlock.innerHTML = html;
    }
  }

  // roles & medals
  const rolesBlock = document.getElementById('rolesBlock');
  if(!state){ rolesBlock.innerHTML = '—'; } else {
    const offices = state.politics.offices.map(o=>`<div class="role-pill">${o.title} (${o.years}y)</div>`).join('');
    const units = state.military.units.map(u=>`<div class="role-pill">${u}</div>`).join('');
    rolesBlock.innerHTML = `<div><strong>Military Units</strong><div>${units || '<span class="muted">None</span>'}</div><strong style="margin-top:6px;">Political Offices</strong><div>${offices || '<span class="muted">None</span>'}</div></div>`;
  }

  // history & achievements
  document.getElementById('historyBlock').innerHTML = (state && state.history.length) ? state.history.slice(0,6).map(h=>`<div>${h}</div>`).join('') : 'No history yet';
  document.getElementById('achieveBlock').innerHTML = (state && state.achievements.length) ? state.achievements.slice(0,6).map(a=>`<div>• ${a}</div>`).join('') : 'No achievements yet';

  // medals list
  const medalEl = document.getElementById('medalsList');
  if(!state || !state.medals || state.medals.length === 0){
    medalEl.innerHTML = '<div class="muted">No medals yet</div>';
  } else {
    let mhtml = '';
    state.medals.forEach(m=>{
      const meta = MEDAL_CATALOG[m] || {tier:'bronze',desc:''};
      mhtml += `<div class="medal ${meta.tier}"><div class="icon">${m[0]}</div><div><strong>${m}</strong><div class="muted">${meta.desc}</div></div></div>`;
    });
    medalEl.innerHTML = mhtml;
  }
}

// Modal-ish prompt to choose deployment details
function showDeployModal(typeKey){
  if(!state || !state.military.enlisted){ alert('Must be enlisted.'); return; }
  const choice = prompt(`Start deployment:\nType: ${DEPLOYMENT_TYPES[typeKey].label}\nEnter duration in years (1-4) and engagement style: Aggressive / Balanced / Restraint\nFormat: years,style\nExample: 2,Aggressive`, '2,Balanced');
  if(!choice) return;
  const parts = choice.split(',');
  const years = Math.max(1, Math.min(4, parseInt(parts[0]) || 1));
  const style = (parts[1] || 'Balanced').trim();
  startDeployment(typeKey, years, style, true);
}

// Wire UI buttons
document.getElementById('newBtn').onclick = ()=>{
  const name = document.getElementById('nameInput').value || prompt('Enter your name') || 'Player';
  const region = document.getElementById('regionSelect').value;
  newLife(name, region);
};
document.getElementById('saveBtn').onclick = ()=>{ save(); alert('Saved.'); };
document.getElementById('loadBtn').onclick = ()=>{ if(!load()) alert('No save found.'); };
document.getElementById('resetBtn').onclick = ()=>{ resetGame(); };
document.getElementById('exportBtn').onclick = ()=>{ exportJSON(); alert('Exported JSON to box below.'); };
document.getElementById('passYearBtn').onclick = ()=>{ if(!state) return alert('Start a life first.'); passYears(1); };
document.getElementById('pass5Btn').onclick = ()=>{ if(!state) return alert('Start a life first.'); passYears(5); };
document.getElementById('autoPlayBtn').onclick = ()=>{ if(!state) return alert('Start a life first.'); autoPlay(10); };
document.getElementById('exportBtn').onclick = ()=>{ exportJSON(); alert('Exported JSON to box below.'); };

// Load on start if exists
if(!load()) renderAll();

// Expose functions used by inline buttons
window.startCareer = startCareer;
window.enlist = enlist;
window.tryoutUnit = tryoutUnit;
window.enterPolitics = enterPolitics;
window.runForTopOffice = runForTopOffice;
window.advancePoliticsYears = advancePoliticsYears;
window.retire = retire;
window.autoPlay = autoPlay;
window.exportJSON = exportJSON;
window.startDeployment = startDeployment;
window.foundCompany = foundCompany;

</script>
</body>
</html>
